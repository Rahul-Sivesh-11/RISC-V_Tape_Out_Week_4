# CMOS Switching Threshold and Dynamic Simulation Analysis

## Introduction to Voltage Transfer Characteristics

The VTC represents a graphical plot with Vout on the y-axis versus Vin on the x-axis, generated by gradually sweeping Vin from 0 to VDD. This curve comprehensively characterizes the inverter's static switching performance.
  - `Vout = fn(Vin)`

The input voltage (Vin) is progressively increased from ground to VDD while monitoring the corresponding steady-state output (Vout). The resulting VTC characteristic exhibits three distinguishable regions:

**Low input region (Vin ≈ 0):**
The PMOS device operates in full conduction while the NMOS remains in cutoff. Consequently, the output voltage maintains proximity to VDD.

**Transition region:**
As Vin increases, both devices enter partial conduction. The output voltage begins transitioning from VDD toward ground potential. This represents the state-switching region, containing the switching threshold (Vm) — defined as the point where Vin equals Vout.

**High input region (Vin ≈ VDD):**
The NMOS device achieves full conduction (`ON` state), the PMOS enters cutoff (`OFF` state), and the output voltage approaches 0 V.

The characteristic S-shaped VTC profile emerges from the alternating dominance of NMOS and PMOS transistors as input voltage varies.

**During low Vin conditions:**
The NMOS remains completely in cutoff (`OFF`), while the PMOS conducts fully. This establishes a robust conduction path from VDD to the output node, maintaining Vout near VDD potential.

**As Vin begins rising:**
The NMOS initiates conduction (`ON`) while the PMOS progressively enters cutoff (`OFF`). Throughout this region, both devices exhibit partial conduction, with output voltage determined by their relative conductances — analogous to resistive voltage division.

**At the midpoint voltage:**
Both devices conduct with approximately equal strength. This produces rapid output voltage transition, generating the steep central portion of the characteristic curve. This region defines the inverter's switching state and demonstrates maximum voltage gain.

**During high Vin conditions:**
The PMOS completely ceases conduction (`OFF`), while the NMOS achieves full conduction, discharging the output node to ground potential (`0 V`).

---

## SPICE Simulation Methodology for CMOS Inverter

<img width="1304" height="599" alt="image" src="https://github.com/user-attachments/assets/145433fe-e20b-44be-8ad8-b52ab0ab535e" />

This diagram demonstrates the procedure for constructing a SPICE deck for CMOS inverter analysis.

Construction requirements include:

**Component interconnection**: Specify the connectivity between PMOS (M1), NMOS (M2), supply voltage (VDD), ground reference (VSS), input terminal (Vin), and output terminal (Vout) within the circuit topology.

**Parameter specification**: Define critical parameters including transistor dimensions (W/L ratios), supply voltage magnitude (e.g., 2.5V), and load capacitance value (e.g., Cload = 10 fF).

**Node identification**: Recognize essential circuit nodes — specifically, `in`, `out`, `VDD`, `VSS`, and individual transistor terminals.

**Node nomenclature**: Establish clear and systematic node naming conventions to facilitate netlist creation, simulation execution, and result interpretation.

Following this methodology produces a well-structured and accurate SPICE netlist suitable for reliable CMOS inverter simulation.

---

## Simulation Procedures

### VTC Analysis Setup

```bash
vim day3_inv_vtc_Wp084_Wn036.spice
```
<img width="1062" height="756" alt="image" src="https://github.com/user-attachments/assets/abb1cfd1-22ae-4096-9073-a6d9d6a6ac65" />

### VTC Plot Generation
```bash
ngspice day3_inv_vtc_Wp084_Wn036.spice
plot out vs in
```

<img width="708" height="616" alt="image" src="https://github.com/user-attachments/assets/263b8064-f82c-404e-a965-e91e9822bdb0" />

### Transient Analysis Configuration

```bash
vim day3_inv_tran_Wp084_Wn036.spice 
```
<img width="997" height="651" alt="image" src="https://github.com/user-attachments/assets/6930d02d-a161-402a-b95e-e22a8138141f" />

The configured rise and fall propagation delay parameters are set to 0.1 ns, with a total pulse duration of 4ns.

### Transient Waveform Visualization

```bash
ngspice day3_inv_tran_Wp084_Wn036.spice 
plot out vs time in
exit
```

---

## CMOS Inverter Propagation Delay Characterization (Transient Analysis)

The waveform below depicts the transient behavior of a CMOS inverter. From this temporal response, we extract:

- **Rise propagation delay (t<sub>PLH</sub>)**
- **Fall propagation delay (t<sub>PHL</sub>)**

### Propagation Delay Calculation Methodology

| Delay Parameter | Calculation Formula |
|------------|---------|
| **Rise Delay (t<sub>PLH</sub>)** | `t(Vout = 0.5 × VDD rising) - t(Vin = 0.5 × VDD falling)` |
| **Fall Delay (t<sub>PHL</sub>)** | `t(Vout = 0.5 × VDD falling) - t(Vin = 0.5 × VDD rising)` |

Where:
- `VDD` = Supply voltage magnitude
- `0.5 × VDD` = 50% voltage threshold (standard delay measurement reference)
- `Vout` / `Vin` = Output and input signal waveforms

### SPICE Measurement Command Syntax (Example)

```spice
CMOS Inverter Transient Analysis - Delay Calculation
.measure tPLH TRIG v(in) VAL='0.5*VDD' FALL=1 TARG v(out) VAL='0.5*VDD' RISE=1
.measure tPHL TRIG v(in) VAL='0.5*VDD' RISE=1 TARG v(out) VAL='0.5*VDD' FALL=1
```

<img width="701" height="611" alt="Screenshot from 2025-10-18 16-50-16" src="https://github.com/user-attachments/assets/dd96d174-b40c-467b-a0b0-a9800841acd6" />

---

## Switching Threshold Analysis (Vm)

Comparative analysis of both characteristic curves enables investigation of switching threshold behavior.

<img width="1210" height="650" alt="image" src="https://github.com/user-attachments/assets/2fa303fc-bcd4-4e72-a870-8abb7f131b72" />

- High Vin conditions produce low Vout, and conversely.
- The switching threshold voltage (Vm) represents the VTC (Voltage Transfer Characteristic) curve location where input and output voltages are equal:  
    - Vin = Vout​
- This parameter critically influences noise margin specifications and inverter reliability.

At this voltage level:

- Both NMOS and PMOS devices enter conduction.
- Both transistors operate within the saturation regime.
- This configuration generates elevated leakage current due to the direct conduction path from VDD to VSS.
- The inverter demonstrates high voltage gain, producing steep VTC curve transitions.

**Left characteristic**:    
     - Yields `Vm ≈ 0.98 V`

**Right characteristic**:  
     - Yields `Vm ≈ 1.2 V`

**Operational regime classification:**

- Distinct curve segments correspond to specific transistor operating regimes:
  - **PMOS Linear / NMOS OFF**
  - **PMOS Linear / NMOS Saturation**
  - **PMOS Saturation / NMOS Saturation** — This identifies the `Vm` location.
  - **PMOS Saturation / NMOS Linear**
  - **PMOS OFF / NMOS Linear**

<img width="1111" height="568" alt="image" src="https://github.com/user-attachments/assets/0c3ed069-c29c-494f-8c93-e33b4d49b366" />

The drift current magnitude for both CMOS transistor types can be expressed using the equations presented in the figure below:

<img width="978" height="559" alt="image" src="https://github.com/user-attachments/assets/88f35459-4f48-49d5-bf2f-31dac54ca5d3" />

Applying the equilibrium condition Idsp + Idsn = 0 yields the following relationship:

<img width="852" height="425" alt="image" src="https://github.com/user-attachments/assets/a8873d8e-fb56-452f-85dd-9ea92c1dd137" />

Additionally, specifying the `Vm` value enables determination of the corresponding `W/L` ratio:

<img width="963" height="224" alt="image" src="https://github.com/user-attachments/assets/a83f2e40-391d-4539-94e9-acf5d5fc8619" />

Analysis of the tabulated data below reveals:
- When Wp/Lp ≈ 2 × Wn/Ln, the inverter demonstrates balanced rise and fall delay characteristics (approximately 80 ps each).
- Under this sizing condition, the switching threshold Vm approximates 1.2 V.

<img width="719" height="255" alt="image" src="https://github.com/user-attachments/assets/5b54f34b-a305-493d-85ac-a97a039dd71c" />

---

## Critical Insights from PMOS & NMOS Dimensional Scaling

### Optimized Clock Inverter Architecture
- **Design criterion:** `(Wp/Lp) = 2 × (Wn/Ln)`
- **Performance benefit:** Achieves approximately symmetric rise and fall delay characteristics.
- **Application domain:** Optimal for clock buffer implementations and clock distribution network design, where temporal symmetry is critical.

---

### Data Path Inverter Configurations
- Alternative PMOS/NMOS dimensional ratios serve as conventional inverters or signal buffers.
- Primarily utilized in data path circuitry rather than clock network applications.

---

### Switching Threshold Behavior
- For PMOS/NMOS dimensional ratios of:
  - `(Wp/Lp) = 2 × (Wn/Ln)` and `(Wp/Lp) = 3 × (Wn/Ln)` → Produces significantly reduced switching threshold voltage.
  - `(Wp/Lp) = 4 × (Wn/Ln)` and `(Wp/Lp) = 5 × (Wn/Ln)` → Similarly generates very low switching threshold.
- **Design consequence:** The inverter initiates state transition earlier as input voltage rises.

---

### PMOS Width Scaling Effects
- **Increasing Wp/Lp:** Substantially reduces rise delay magnitude.
- **Physical mechanism:** Larger PMOS geometry delivers increased charging current to output capacitance.
- **Performance outcome:** Accelerated output voltage rise time.

---

### On-Resistance Comparative Analysis
- R_on(PMOS) ≈ 2.5 × R_on(NMOS)
- PMOS exhibits elevated on-resistance, necessitating increased width to achieve balanced rise/fall characteristics.

---

## CMOS Inverter Applications in Integrated Circuit Design

### Static Timing Analysis (STA)
- Functions as reference delay cell for timing arc characterization.
- Facilitates computation of rise/fall delays, setup time, and hold time parameters.

### Clock Tree Synthesis (CTS)
- Operates as clock buffer for fanout distribution.
- Regenerates clock signals and introduces controlled skew to balance clock network propagation delays throughout the die.
- Implemented by substituting clock inverter cells in place of standard inverter cells.

When clock buffer rise and fall delays exhibit close matching, duty cycle correction becomes unnecessary.

<img width="1294" height="726" alt="image" src="https://github.com/user-attachments/assets/cf17c3ce-04af-478d-bb44-56590df65806" />

Conversely, when imbalance exists—typically resulting from PMOS and NMOS on-resistance mismatch—duty cycle correction circuits are integrated into the clock tree to restore and preserve a 50% duty cycle.

---
